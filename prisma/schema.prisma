datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model GitlabMergeRequestEvent {
  id               Int                   @id @default(autoincrement())
  eventId          Int                   @unique
  sha              String
  chatId           String
  messageId        Int
  messageText      String
  state            String
  status           String
  url              String
  pipelines        GitlabPipelineEvent[]
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  GitlabBuildEvent GitlabBuildEvent[]
}

model GitlabPipelineEvent {
  id             Int                     @id @default(autoincrement())
  eventId        Int                     @unique
  sha            String
  status         String
  stages         String[]
  url            String
  mergeRequestId Int
  mergeRequest   GitlabMergeRequestEvent @relation(fields: [mergeRequestId], references: [id])
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
}

model GitlabBuildEvent {
  id             Int                     @id @default(autoincrement())
  eventId        Int                     @unique
  sha            String
  stage          String
  status         String
  name           String
  url            String?
  mergeRequestId Int
  mergeRequest   GitlabMergeRequestEvent @relation(fields: [mergeRequestId], references: [id])
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
}
